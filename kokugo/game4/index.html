<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ã²ã‚‰ãŒãªéŸ³ã‚ã¦ã‚²ãƒ¼ãƒ </title>
  <style>
    body {
      font-family: 'UD ãƒ‡ã‚¸ã‚¿ãƒ« æ•™ç§‘æ›¸ä½“ N-R', 'Yu Kyokasho', sans-serif;
      text-align: center;
      background-color: #fff8f0;
      margin: 2rem;
    }

    h1 {
      font-size: 2.5rem;
      margin-bottom: 1.5rem;
    }

    button {
      font-size: 1.2rem;
      margin: 0.4rem;
      padding: 0.6rem 1.2rem;
      border-radius: 10px;
      border: none;
      background-color: #f0f0f0;
      cursor: pointer;
    }

    #controls, #groupButtons {
      margin-bottom: 1.5rem;
    }

    #choices {
      margin-top: 1rem;
    }

    #result {
      font-size: 3rem;
      margin-top: 1rem;
      height: 100px;
    }

    #result img {
      width: 80px;
      height: 80px;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <h1>ã²ã‚‰ãŒãªéŸ³ã‚ã¦ã‚²ãƒ¼ãƒ </h1>

  <div id="groupButtons">
    <p>ãƒ¢ãƒ¼ãƒ‰ã‚’é¸ã‚“ã§ã­</p>
    <!-- æ—¢å­˜ã®è¡Œãƒ¢ãƒ¼ãƒ‰ -->
    <button id="mode-all">ğŸ² å…¨ä½“ãƒ¢ãƒ¼ãƒ‰</button>
    <button data-group="ã‚">ã‚è¡Œ</button>
    <button data-group="ã‹">ã‹è¡Œ</button>
    <button data-group="ã•">ã•è¡Œ</button>
    <button data-group="ãŸ">ãŸè¡Œ</button>
    <button data-group="ãª">ãªè¡Œ</button>
    <button data-group="ã¯">ã¯è¡Œ</button>
    <button data-group="ã¾">ã¾è¡Œ</button>
    <button data-group="ã‚„">ã‚„è¡Œ</button>
    <button data-group="ã‚‰">ã‚‰è¡Œ</button>
    <button data-group="ã‚">ã‚è¡Œ</button>

    <!-- æ–°ã—ã„ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ¼ãƒ‰ -->
    <button data-custom="ã—ã¦ãƒã†ãƒã¯ã•ã‚“">ã—ã¦ãƒã†ãƒã¯ã•ã‚“</button>
    <button data-custom="ã²ãŒã—ã–ã‚ã‚†ã‚">ã²ãŒã—ã–ã‚ã‚†ã‚</button>
    <button data-custom="ã†ãˆã¯ã‚‰ã‚ã•ã²">ã†ãˆã¯ã‚‰ã‚ã•ã²</button>
  </div>

  <div id="controls" class="hidden">
    <button id="playNew">â–¶ ãŠã¨ã‚’ãã</button>
    <button id="playAgain">ğŸ” ã‚‚ã†ã„ã¡ã©</button>
  </div>

  <div id="choices" class="hidden"></div>
  <div id="result"></div>

  <audio id="correctSound" src="sounds/pinpon.mp3"></audio>

  <script>
    const kanaGroups = {
      "ã‚": ["ã‚", "ã„", "ã†", "ãˆ", "ãŠ"],
      "ã‹": ["ã‹", "ã", "ã", "ã‘", "ã“"],
      "ã•": ["ã•", "ã—", "ã™", "ã›", "ã"],
      "ãŸ": ["ãŸ", "ã¡", "ã¤", "ã¦", "ã¨"],
      "ãª": ["ãª", "ã«", "ã¬", "ã­", "ã®"],
      "ã¯": ["ã¯", "ã²", "ãµ", "ã¸", "ã»"],
      "ã¾": ["ã¾", "ã¿", "ã‚€", "ã‚", "ã‚‚"],
      "ã‚„": ["ã‚„", "ã‚†", "ã‚ˆ"],
      "ã‚‰": ["ã‚‰", "ã‚Š", "ã‚‹", "ã‚Œ", "ã‚"],
      "ã‚": ["ã‚", "ã‚’", "ã‚“"]
    };

    const customGroups = {
      "ã—ã¦ãƒã†ãƒã¯ã•ã‚“": ["ã—", "ã¦ãƒ", "ã†ãƒ", "ã¯", "ã•", "ã‚“"],
      "ã²ãŒã—ã–ã‚ã‚†ã‚": ["ã²", "ãŒ", "ã—", "ã–", "ã‚", "ã‚†"],
      "ã†ãˆã¯ã‚‰ã‚ã•ã²": ["ã†", "ãˆ", "ã¯", "ã‚‰", "ã‚", "ã•", "ã²"]
    };

    const allKana = Object.values(kanaGroups).flat();

    let currentGroup = [];
    let remainingGroupKana = [];
    let correctKana = "";
    let currentAudio = null;
    let isAllMode = false;

    const groupButtonsDiv = document.getElementById("groupButtons");
    const playNewBtn = document.getElementById("playNew");
    const playAgainBtn = document.getElementById("playAgain");
    const controlsDiv = document.getElementById("controls");
    const choicesDiv = document.getElementById("choices");
    const resultDiv = document.getElementById("result");
    const correctSound = document.getElementById("correctSound");

    function shuffle(array) {
      return array.sort(() => Math.random() - 0.5);
    }

    function playKanaAudio(kana) {
      const audio = new Audio(`sounds/${kana}.mp3`);
      audio.play();
      currentAudio = audio;
    }

    function showGameUI() {
      groupButtonsDiv.classList.add("hidden");
      controlsDiv.classList.remove("hidden");
      choicesDiv.classList.remove("hidden");
    }

    function showGroupSelection() {
      groupButtonsDiv.classList.remove("hidden");
      controlsDiv.classList.add("hidden");
      choicesDiv.classList.add("hidden");
      resultDiv.innerHTML = "";
      isAllMode = false;
    }

    function loadNextQuestion() {
      resultDiv.innerHTML = "";

      if (!isAllMode) {
        if (remainingGroupKana.length === 0) {
          showGroupSelection();
          return;
        }
        correctKana = remainingGroupKana.pop();
      } else {
        correctKana = allKana[Math.floor(Math.random() * allKana.length)];
      }

      playKanaAudio(correctKana);

      const baseGroup = isAllMode ? allKana : currentGroup;
      const choices = new Set([correctKana]);
      while (choices.size < 7 && choices.size < baseGroup.length) {
        const random = baseGroup[Math.floor(Math.random() * baseGroup.length)];
        choices.add(random);
      }

      const shuffled = shuffle([...choices]);

      choicesDiv.innerHTML = "";
      shuffled.forEach(kana => {
        const btn = document.createElement("button");
        btn.textContent = kana;
        btn.onclick = () => {
          if (kana === correctKana) {
            correctSound.play();
            resultDiv.innerHTML = '<img src="images/hanamaru.png" alt="èŠ±ä¸¸">';
            setTimeout(() => loadNextQuestion(), 1500);
          } else {
            resultDiv.textContent = "ï¼Ÿ";
          }
        };
        choicesDiv.appendChild(btn);
      });
    }

    document.querySelectorAll('#groupButtons button[data-group]').forEach(btn => {
      btn.onclick = () => {
        const groupKey = btn.dataset.group;
        currentGroup = kanaGroups[groupKey];
        remainingGroupKana = shuffle([...currentGroup]);
        isAllMode = false;
        showGameUI();
        loadNextQuestion();
      };
    });

    document.querySelectorAll('#groupButtons button[data-custom]').forEach(btn => {
      btn.onclick = () => {
        const customKey = btn.dataset.custom;
        currentGroup = customGroups[customKey];
        remainingGroupKana = shuffle([...currentGroup]);
        isAllMode = false;
        showGameUI();
        loadNextQuestion();
      };
    });

    document.getElementById("mode-all").onclick = () => {
      isAllMode = true;
      currentGroup = allKana;
      showGameUI();
      loadNextQuestion();
    };

    playNewBtn.onclick = loadNextQuestion;
    playAgainBtn.onclick = () => {
      if (correctKana) {
        playKanaAudio(correctKana);
      }
    };

    showGroupSelection();
  </script>
</body>
</html>
