<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ひらがな⇔カタカナゲーム</title>
  <style>
    body {
      font-family:
        "UD Digi Kyokasho",
        "UD デジタル 教科書体",
        "Hiragino Maru Gothic ProN",
        "Yu Gothic",
        sans-serif;
      background: #f0f8ff;
      text-align: center;
      padding: 20px;
    }
    h1 { font-size: 2em; }
    h2 { margin-top: 25px; }
    .start-button {
      background-color: #b2ebf2;
      border: none;
      border-radius: 10px;
      padding: 15px;
      margin: 8px;
      font-size: 1.3em;
      cursor: pointer;
    }
    .question {
      font-size: 3em;
      margin: 20px;
      border: 4px solid #000;
      display: inline-block;
      padding: 10px 20px;
      border-radius: 15px;
    }
    .options {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
    .option {
      background-color: #fff;
      border: 2px solid #ccc;
      border-radius: 10px;
      margin: 10px;
      padding: 15px;
      font-size: 2em;
      cursor: pointer;
      width: 80px;
    }
    .result { font-size: 3em; margin-top: 20px; }
    .score { font-size: 1.5em; margin: 10px; }
    .hidden { display: none; }
    .highlight { animation: blink 1s infinite; }
    @keyframes blink {
      0%,100% { background-color: yellow; }
      50% { background-color: white; }
    }
  </style>
</head>
<body>

<h1>ひらがなとおなじカタカナをえらぼう</h1>

<!-- スタート画面 -->
<div id="start-screen">

  <h2>せいおん</h2>
  <button class="start-button" onclick="startGame('ア')">あぎょう</button>
  <button class="start-button" onclick="startGame('カ')">かぎょう</button>
  <button class="start-button" onclick="startGame('サ')">さぎょう</button>
  <button class="start-button" onclick="startGame('タ')">たぎょう</button>
  <button class="start-button" onclick="startGame('ナ')">なぎょう</button>
  <button class="start-button" onclick="startGame('ハ')">はぎょう</button>
  <button class="start-button" onclick="startGame('マ')">まぎょう</button>
  <button class="start-button" onclick="startGame('ヤ')">やぎょう</button>
  <button class="start-button" onclick="startGame('ラ')">らぎょう</button>
  <button class="start-button" onclick="startGame('ワ')">わぎょう</button>

  <h2>だくおん</h2>
  <button class="start-button" onclick="startGame('ガ')">がぎょう</button>
  <button class="start-button" onclick="startGame('ザ')">ざぎょう</button>
  <button class="start-button" onclick="startGame('ダ')">だぎょう</button>
  <button class="start-button" onclick="startGame('バ')">ばぎょう</button>

  <h2>はんだくおん</h2>
  <button class="start-button" onclick="startGame('パ')">ぱぎょう</button>

  <hr style="margin:20px 0;">

  <button class="start-button" onclick="startGame('all')">ぜんぶ</button>

</div>

<!-- ゲーム画面 -->
<div id="game-screen" class="hidden">
  <div class="score" id="score-display"></div>
  <div class="question" id="question-box"></div>
  <div class="options" id="options-box"></div>
  <div class="result" id="result-box"></div>
</div>

<!-- 終了画面 -->
<div id="end-screen" class="hidden">
  <h2 id="final-score"></h2>
  <img src="images/hanamaru.png" alt="はなまる" width="150" />
</div>

<audio id="correct-sound" src="sounds/correct.mp3"></audio>

<script>
const hiraToKata = {
  あ:"ア",い:"イ",う:"ウ",え:"エ",お:"オ",
  か:"カ",き:"キ",く:"ク",け:"ケ",こ:"コ",
  が:"ガ",ぎ:"ギ",ぐ:"グ",げ:"ゲ",ご:"ゴ",
  さ:"サ",し:"シ",す:"ス",せ:"セ",そ:"ソ",
  ざ:"ザ",じ:"ジ",ず:"ズ",ぜ:"ゼ",ぞ:"ゾ",
  た:"タ",ち:"チ",つ:"ツ",て:"テ",と:"ト",
  だ:"ダ",ぢ:"ヂ",づ:"ヅ",で:"デ",ど:"ド",
  な:"ナ",に:"ニ",ぬ:"ヌ",ね:"ネ",の:"ノ",
  は:"ハ",ひ:"ヒ",ふ:"フ",へ:"ヘ",ほ:"ホ",
  ば:"バ",び:"ビ",ぶ:"ブ",べ:"ベ",ぼ:"ボ",
  ぱ:"パ",ぴ:"ピ",ぷ:"プ",ぺ:"ペ",ぽ:"ポ",
  ま:"マ",み:"ミ",む:"ム",め:"メ",も:"モ",
  や:"ヤ",ゆ:"ユ",よ:"ヨ",
  ら:"ラ",り:"リ",る:"ル",れ:"レ",ろ:"ロ",
  わ:"ワ",を:"ヲ",ん:"ン"
};

const gyouMap = {
  ア:["あ","い","う","え","お"],
  カ:["か","き","く","け","こ"],
  ガ:["が","ぎ","ぐ","げ","ご"],
  サ:["さ","し","す","せ","そ"],
  ザ:["ざ","じ","ず","ぜ","ぞ"],
  タ:["た","ち","つ","て","と"],
  ダ:["だ","ぢ","づ","で","ど"],
  ナ:["な","に","ぬ","ね","の"],
  ハ:["は","ひ","ふ","へ","ほ"],
  バ:["ば","び","ぶ","べ","ぼ"],
  パ:["ぱ","ぴ","ぷ","ぺ","ぽ"],
  マ:["ま","み","む","め","も"],
  ヤ:["や","ゆ","よ"],
  ラ:["ら","り","る","れ","ろ"],
  ワ:["わ","を","ん"]
};

let mode="", questions=[], current=0, score=0, timer;
let lateAnswer=false, alreadyWrong=false, answered=false;

function startGame(selected){
  mode=selected;
  document.getElementById("start-screen").classList.add("hidden");
  document.getElementById("game-screen").classList.remove("hidden");
  score=0; current=0;
  questions = mode==="all"
    ? Object.keys(hiraToKata).sort(()=>0.5-Math.random()).slice(0,20)
    : gyouMap[mode].slice();
  document.getElementById("score-display").innerText =
    mode==="all" ? "てんすう：0てん" : "";
  nextQuestion();
}

function nextQuestion(){
  if(current>=questions.length){ endGame(); return; }
  document.getElementById("result-box").innerText="";
  const q=questions[current];
  const correct=hiraToKata[q];
  document.getElementById("question-box").innerText=`「 ${q} 」`;
  const opts=[correct];
  while(opts.length<7){
    const r=Object.values(hiraToKata)[Math.floor(Math.random()*Object.values(hiraToKata).length)];
    if(!opts.includes(r)) opts.push(r);
  }
  opts.sort(()=>Math.random()-0.5);
  const box=document.getElementById("options-box");
  box.innerHTML="";
  opts.forEach(o=>{
    const d=document.createElement("div");
    d.className="option";
    d.innerText=o;
    d.onclick=()=>checkAnswer(o,correct);
    box.appendChild(d);
  });
  answered=false; alreadyWrong=false; lateAnswer=false;
  timer=setTimeout(()=>{
    document.querySelectorAll(".option").forEach(b=>{
      if(b.innerText===correct) b.classList.add("highlight");
    });
    lateAnswer=true;
  },7000);
}

function checkAnswer(sel,correct){
  if(answered) return;
  clearTimeout(timer);
  const r=document.getElementById("result-box");
  if(sel===correct){
    document.getElementById("correct-sound").play();
    r.innerText="〇"; r.style.color="red";
    if(mode==="all"&&!lateAnswer&&!alreadyWrong){
      score+=5;
      document.getElementById("score-display").innerText=`てんすう：${score}てん`;
    }
    answered=true; current++;
    setTimeout(nextQuestion,1000);
  }else{
    r.innerText="？"; alreadyWrong=true;
    document.querySelectorAll(".option").forEach(b=>{
      if(b.innerText===correct) b.classList.add("highlight");
    });
  }
}

function endGame(){
  document.getElementById("game-screen").classList.add("hidden");
  if(mode==="all"){
    document.getElementById("end-screen").classList.remove("hidden");
    document.getElementById("final-score").innerText =
      `あなたのてんすう：${score}てん／100てん`;
    setTimeout(()=>location.reload(),4000);
  }else location.reload();
}
</script>

</body>
</html>
