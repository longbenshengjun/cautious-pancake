<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ひきざんげーむ</title>

<style>
:root{ --accent:#007aff; --yellow:#ffd500; }
body{
  margin:0; padding:20px;
  font-family:"Kyokasho","Noto Sans JP",sans-serif;
  background:#eef7ff;
  display:flex; justify-content:center; align-items:center;
}
.app{
  max-width:720px; width:100%;
  background:#fff; padding:28px;
  border-radius:16px; text-align:center;
}
.answers{
  display:flex; flex-wrap:wrap; gap:8px; justify-content:center;
}
.answers button{
  width:56px;height:56px;
  font-size:20px;border:0;border-radius:8px;
  cursor:pointer;
}
.blink{
  animation: blinkYellow 0.4s linear 3;
}
@keyframes blinkYellow{
  0%{background:#fff;}
  50%{background:var(--yellow);}
  100%{background:#fff;}
}
.overlay{
  position:fixed; inset:0;
  display:flex; justify-content:center; align-items:center;
  pointer-events:none;
}
.big-red{
  width:240px;height:240px;
  border-radius:50%;
  background:var(--accent);
  color:#fff;font-size:120px;
  display:flex;justify-content:center;align-items:center;
  transform:scale(0);
  transition:.25s;
}
.big-visible{ transform:scale(1); }
</style>
</head>

<body>
<div class="app">
<h1>ひきざんげーむ</h1>

<div class="start-screen">
  <button id="mode5">5まで</button>
  <button id="mode10">10まで</button>
</div>

<div class="game-area" style="display:none">
  <div id="progress"></div>
  <div id="question" style="font-size:36px;margin:16px 0"></div>
  <div class="answers" id="answers"></div>
  <div id="score" style="margin-top:12px;font-weight:700"></div>
</div>

<div class="result-screen" style="display:none">
  <h2>おつかれさま！</h2>
  <div id="finalScore" style="font-size:22px"></div>
  <button onclick="location.reload()">もういちど</button>
</div>
</div>

<!-- 正解音（以前と同じ sounds フォルダ） -->
<audio id="correctSound" src="sounds/correct.mp3" preload="auto"></audio>

<div class="overlay">
  <div class="big-red" id="bigRed">○</div>
</div>

<script>
const mode5 = document.getElementById("mode5");
const mode10 = document.getElementById("mode10");
const gameArea = document.querySelector(".game-area");
const startScreen = document.querySelector(".start-screen");
const resultScreen = document.querySelector(".result-screen");
const questionEl = document.getElementById("question");
const answersEl = document.getElementById("answers");
const progressEl = document.getElementById("progress");
const scoreEl = document.getElementById("score");
const finalScore = document.getElementById("finalScore");
const bigRed = document.getElementById("bigRed");
const correctSound = document.getElementById("correctSound");

let problems=[], current=0, score=0;
let hadMistake=false;

function makeProblems(max){
  const arr=[];
  while(arr.length<10){
    const a=Math.floor(Math.random()*max)+1;
    const b=Math.floor(Math.random()*(a-1))+1;
    const d=a-b;
    if(d>=1 && d<=9) arr.push({a,b,d});
  }
  return arr;
}

function start(max){
  problems=makeProblems(max);
  current=0; score=0;
  startScreen.style.display="none";
  resultScreen.style.display="none";
  gameArea.style.display="block";
  show();
}

function show(){
  hadMistake=false;
  const p=problems[current];
  progressEl.textContent=`もんだい ${current+1} / 10`;
  scoreEl.textContent=`すこあ: ${score}`;
  questionEl.textContent=`${p.a} − ${p.b} = ?`;
  answersEl.innerHTML="";
  for(let i=1;i<=9;i++){
    const b=document.createElement("button");
    b.textContent=i;
    b.onclick=()=>check(i);
    answersEl.appendChild(b);
  }
}

function check(val){
  const p=problems[current];
  if(val===p.d){
    if(!hadMistake){
      score+=10;
      playCorrectSound();
    }
    showCircle(next);
  }else{
    hadMistake=true;
    blinkCorrect(p.d);
  }
}

function playCorrectSound(){
  if(correctSound){
    correctSound.currentTime=0;
    correctSound.play().catch(()=>{});
  }
}

function blinkCorrect(correct){
  document.querySelectorAll(".answers button").forEach(b=>{
    if(Number(b.textContent)===correct){
      b.classList.remove("blink");
      void b.offsetWidth;
      b.classList.add("blink");
    }
  });
}

function showCircle(cb){
  bigRed.classList.add("big-visible");
  setTimeout(()=>{
    bigRed.classList.remove("big-visible");
    cb();
  },600);
}

function next(){
  current++;
  if(current>=10){
    gameArea.style.display="none";
    resultScreen.style.display="block";
    finalScore.textContent=`${score} / 100`;
  }else{
    show();
  }
}

mode5.onclick=()=>start(5);
mode10.onclick=()=>start(10);
</script>
</body>
</html>
