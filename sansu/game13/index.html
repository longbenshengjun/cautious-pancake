<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>さいころをえらぼう</title>
  <style>
    body {
      font-family: "YuMincho", "Hiragino Mincho ProN", serif;
      background-color: #fef6f0;
      text-align: center;
      padding: 20px;
    }

    h1 {
      color: #4a4a4a;
      font-size: 2em;
    }

    .start-screen, .game-screen, .result-screen {
      display: none;
    }

    .active {
      display: block;
    }

    .btn {
      font-size: 1.5em;
      padding: 10px 20px;
      margin: 10px;
      background-color: #ffddee;
      border: 2px solid #ff99cc;
      border-radius: 12px;
      cursor: pointer;
    }

    .dice-image {
      width: 200px;
      height: 200px;
      margin: 10px auto;
    }

    .choices {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 20px;
      margin-top: 20px;
    }

    .choice-img {
      width: 140px;
      height: 140px;
      cursor: pointer;
      border: 3px solid transparent;
      border-radius: 12px;
    }

    .choice-img:hover {
      border-color: #88c;
    }

    #judge {
      font-size: 2em;
      margin: 20px;
    }

    #judge.correct {
      color: red;
    }

    #judge.wrong {
      color: black;
    }

    .target-text {
      font-size: 2em;
      margin-top: 10px;
      color: #444;
    }
  </style>
</head>
<body>
  <h1>さいころをえらぼう</h1>

  <div class="start-screen active" id="start-screen">
    <p>あわせるかずをえらんでね</p>
    <button class="btn" onclick="startGame(7)">７</button>
    <button class="btn" onclick="startGame(8)">８</button>
    <button class="btn" onclick="startGame(9)">９</button>
    <button class="btn" onclick="startGame(10)">１０</button>
  </div>

  <div class="game-screen" id="game-screen">
    <p>つぎのもんだい：</p>
    <p id="question-num"></p>
    <div>
      <img id="dice-image" class="dice-image" src="" alt="サイコロ">
    </div>
    <p class="target-text">あわせて <span id="target-number"></span> に なるのは？</p>
    <div class="choices" id="choices"></div>
    <p id="judge"></p>
  </div>

  <div class="result-screen" id="result-screen">
    <h2>おしまい！</h2>
  </div>

  <audio id="correct-sound" src="sounds/pinpon.mp3"></audio>

  <script>
    const diceImages = [
      'img/dice1.png',
      'img/dice2.png',
      'img/dice3.png',
      'img/dice4.png',
      'img/dice5.png',
      'img/dice6.png'
    ];

    const startScreen = document.getElementById('start-screen');
    const gameScreen = document.getElementById('game-screen');
    const resultScreen = document.getElementById('result-screen');
    const questionNumDisplay = document.getElementById('question-num');
    const targetNumberDisplay = document.getElementById('target-number');
    const diceImage = document.getElementById('dice-image');
    const choicesContainer = document.getElementById('choices');
    const judge = document.getElementById('judge');
    const correctSound = document.getElementById('correct-sound');

    let targetNumber = 7;
    let questionCount = 0;
    let prevDice = -1;

    function startGame(num) {
      targetNumber = num;
      questionCount = 0;
      startScreen.classList.remove('active');
      resultScreen.classList.remove('active');
      gameScreen.classList.add('active');
      nextQuestion();
    }

    function nextQuestion() {
      judge.textContent = '';
      judge.className = '';
      questionNumDisplay.textContent = `${questionCount + 1}もんめ`;
      let diceNum;

      do {
        diceNum = Math.floor(Math.random() * 6) + 1;
      } while (diceNum === prevDice);
      prevDice = diceNum;

      const correctAnswer = targetNumber - diceNum;
      diceImage.src = diceImages[diceNum - 1];
      targetNumberDisplay.textContent = targetNumber;

      // 選択肢（画像）
      choicesContainer.innerHTML = '';
      const answers = new Set();
      if (correctAnswer >= 1 && correctAnswer <= 6) {
        answers.add(correctAnswer);
      }

      while (answers.size < 6) {
        answers.add(Math.floor(Math.random() * 6) + 1);
      }

      const shuffled = Array.from(answers).sort(() => Math.random() - 0.5);

      shuffled.forEach(num => {
        const img = document.createElement('img');
        img.src = diceImages[num - 1];
        img.className = 'choice-img';
        img.onclick = () => checkAnswer(num, correctAnswer);
        choicesContainer.appendChild(img);
      });
    }

    function checkAnswer(selected, correct) {
      if (selected === correct) {
        judge.textContent = '〇';
        judge.className = 'correct';
        correctSound.currentTime = 0;
        correctSound.play();
      } else {
        judge.textContent = '？';
        judge.className = 'wrong';
      }

      setTimeout(() => {
        questionCount++;
        if (questionCount >= 10) {
          showResult();
        } else {
          nextQuestion();
        }
      }, 1000);
    }

    function showResult() {
      gameScreen.classList.remove('active');
      resultScreen.classList.add('active');
      setTimeout(() => {
        resultScreen.classList.remove('active');
        startScreen.classList.add('active');
      }, 4000);
    }
  </script>
</body>
</html>
